var selectedPkgIds=new Set;function activityEdit1(e){var a=$(e).attr("data-record-id"),t=$(e).attr("data-type"),d=$(e).attr("data-quote-uuid");$.ajax({url:"/activities/getEditView",method:"POST",data:{activity_id:a,quoteType:t,quote_uuid:d,_token:$("input[name=_token]").val()},success:function(e){$("#activityEditModalContent").html(e),$("#activityEditModalContent > form").append('<input type="hidden" name="fromLeadView" value="1">'),$("#activityEditModal").modal("show")}})}function isActivityFormValid(){var e=!0;return""==$("#title").val()&&($("#title").next("span").html("Title is required").delay(5e3).hide(0),e=!1),""==$("#description").val()&&($("#description").next("span").html("Description is required").delay(5e3).hide(0),e=!1),""==$("#due_date").val()&&($("#due_date").next("span").html("Due Date is required").delay(5e3).hide(0),e=!1),""==$("#assignee_id").val()&&($("#assignee_id").next("span").html("Assignee is required").delay(5e3).hide(0),e=!1),e}function submitUpdateActivity(e){var a=$(e).attr("data-record-id");if(!isActivityFormValid())return!1;$(e).attr("data-record-id"),$(e).attr("data-type"),$(e).attr("data-quote-uuid");$.ajax({url:"/activities/"+a+"/update",method:"POST",data:{title:$("#title").val(),description:$("#description").val(),due_date:$("#due_date").val(),assignee_id:$("#assignee_id").val(),_token:$("input[name=_token]").val()},success:function(e){$("#activityEditModal").modal("hide"),$("#sucess-div").text("Activity updated successfully").show().delay(5e3).hide(0)}})}function deleteActivity1(e){if(!confirm("Are you sure you want to delete this activity?"))return!1;var a=$(e).attr("data-record-id"),t=$(e).attr("data-quote-uuid"),d=$(e).attr("data-type");$.ajax({url:"/activities/"+a+"/delete",method:"POST",data:{isLeadView:1,quote_uuid:t,_token:$("input[name=_token]").val(),quoteType:d},success:function(e){window.location.reload()}})}function disabledDoneActivities(){$(".activityChk1").each((function(e,a){1==$(a).is(":checked")&&($(a).attr("disabled",!0),$(a).closest("td").siblings().find("button").attr("disabled",!0))}))}function isNumberKey(e,a){var t=e.which?e.which:event.keyCode;return(!(-1!=a.value.indexOf("."))||46!=t)&&(!(a.value.length>8)&&(46==t||!(t>31&&(t<48||t>57))))}function editTravelMemberDetail(e){$.ajax({url:"/travelers/"+e+"/edit",method:"GET",success:function(e){$("#member_model_content_form").html(e),$("#addTravelMemberModal").modal({show:!0})}})}function deleteTravelMemberDetail(e){if(!confirm("Are you sure you want to delete this member?"))return!1;$.ajax({url:"/travelers/"+e,method:"delete",data:{_token:$("input[name=_token]").val()},success:function(e){location.reload()}})}function deleteQuoteDocument(e){if(!confirm("Are you sure to delete this document?"))return!1;var a=$(e).attr("data-quote-id"),t=$(e).attr("data-document-name");console.log(t),$(".loader").show(),$.ajax({url:"/documents/delete",method:"POST",data:{docName:t,quoteId:a,_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),$("#document-delete-success").show(),setTimeout((function(){alert("Document has been deleted."),window.location.reload()}),0)}})}function sendQuoteDocumentsToCustomer(e){if(!confirm("Are you sure you want to send documents to customer?"))return!1;var a=$(e).attr("data-quote-type"),t=$(e).attr("data-quote-uuid");$(".loader").show(),$.ajax({url:"/quotes/"+a+"/"+t+"/send-policy-documents",method:"POST",data:{_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),e.error?($("#document-delete-success").text(e.error),$("#document-delete-success").show()):($("#email-send-success").show(),setTimeout((function(){window.location.reload()}),1e4))}})}$(document).ready((function(){$("#ebp_dob").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd-mm-yy",yearRange:"-80:+00"}),$(".selectpicker").selectpicker(),$("#datepicker").datepicker({dateFormat:"yy-mm-dd"}),$("#datepicker_2").datepicker({dateFormat:"yy-mm-dd"}),$("#transapp_start_date").datepicker({dateFormat:"yy-mm-dd"}),$("#transapp_stop_date").datepicker({dateFormat:"yy-mm-dd"}),$("#dtBasicExample").DataTable(),$(".dataTables_length").addClass("bs-select"),$(".js-example-basic-multiple").select2({placeholder:"Select Permissions to assign against role",width:"100%",allowClear:!0}),$(".select-roles,#user-team-select,#user-product-select,#user-manager-select").select2({width:"100%",allowClear:!0}),$("#enquiry_date, #allocation_date, #tmLeadsStartDate, #tmLeadsEndDate, #amlCreatedStartDate, #amlCreatedEndDate").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"-20:+00"}),$("#dob").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"-80:+00"}),$("input[type^=date]").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",yearRange:"-80:+00"}),window.location.href.indexOf("tmleads")>-1&&2==performance.navigation.type&&location.reload(!0),$("#next_followup_date_field > #next_followup_date").daterangepicker({timePicker:!0,singleDatePicker:!0,timePicker24Hour:!0,locale:{format:"YYYY-MM-DD HH:mm:ss"}}),$("#search-valuation").validate({rules:{carmake:{required:!0},carmodel:{required:!0},cartrim:{required:!0},yom:{required:!0,digits:!0}},errorElement:"span",errorPlacement:function(e,a){e.addClass("invalid-feedback").attr("style","font-size: 17px"),a.closest(".form-group").append(e)},highlight:function(e,a,t){$(e).addClass("is-invalid")},unhighlight:function(e,a,t){$(e).removeClass("is-invalid")}}),$("#calculateValuation").click((function(){if($("#search-valuation").valid()){$("#result").hide();$("#car_make_value option:selected").val(),$("#car_model_value option:selected").val();var e=$("#car_trim_value option:selected").val(),a=$("#yom").val();$.ajax({url:config.routes.valuation_api_route+"get-vehicle-value",type:"post",headers:{"x-api-token":config.routes.valuation_api_token},data:{carModelDetailId:e,yearOfManufacture:a},success:function(e){var a="";e.forEach((e=>{a+="<tr><td>"+e.providerName+"</td><td>"+Number(e.carValue)+"</td><td>"+Number(e.carValueUpperLimit)+"</td><td>"+Number(e.carValueLowerLimit)+"</td></tr>"})),$("#result table tbody").html(a),$("#result").show()},error:function(e,a,t){"Car Trim Not found"==e.responseJSON.msg?($("#error").show(),$("#error").text("Cannot calculate depreciation without trim"),$("#error").hide().delay(5e3).fadeIn(400)):($("#error").show(),$("#error").text(e.responseJSON.msg),$("#error").hide().delay(5e3).fadeIn(400))}})}})),$("#reset").click((function(){$("#result").hide(),$("#carValue").text(""),$("#uLimit").text(""),$("#lLimit").text(""),$("#car_model_value").find("option").not(":first").remove(),$("#car_trim_value").find("option").not(":first").remove(),$("#yom").val((new Date).getFullYear()-1)})),$("#editor1").markdownEditor({preview:!0,fullscreen:!1,onPreview:function(e,a){a(marked(e))}}),$("#editor2").markdownEditor({preview:!0,fullscreen:!1,onPreview:function(e,a){a(marked(e))}}),$("#editor3").markdownEditor({preview:!0,fullscreen:!1,onPreview:function(e,a){a(marked(e))}}),$("#editor4").markdownEditor({preview:!0,fullscreen:!1,onPreview:function(e,a){a(marked(e))}}),$("#datatable").DataTable().destroy(),$("#datatable").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,scrollX:!0}),$(".datatable-show").DataTable().destroy(),$(".datatable-show").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,scrollX:!0}),$("#addon-datatable").DataTable().destroy(),$("#addon-datatable").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,scrollX:!0});var e=$(".user-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.user_datatable_route,data:function(e){e.email=$("#users_email").val(),e.name=$("#users_name").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.user_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"email",name:"email"},{data:"roles",name:"roles"},{data:"teamName",name:"teamName"},{data:"is_active",name:"is_active",render:function(e,a,t){return 1==e?"Active":"InActive"}},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});$(".role-data-table").DataTable({ordering:!1,info:!1,searching:!0,bLengthChange:!1,serverSide:!0,pageLength:20,ajax:config.routes.role_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.role_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".insurancecompany-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.insurancecompany_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.insurancecompany_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"is_active",name:"is_active"},{data:"created_by",name:"created_by"},{data:"updated_by",name:"updated_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".handler-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.handler_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.handler_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"is_active",name:"is_active"},{data:"created_by",name:"created_by"},{data:"updated_by",name:"updated_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".status-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.status_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.status_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"is_active",name:"is_active"},{data:"created_by",name:"created_by"},{data:"updated_by",name:"updated_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});var a=$(".transaction-data-table").DataTable({dom:"Bfrtip",buttons:[{extend:"csv",text:'<i class="fa fa-download" style="color:orange;" id="transapp-export"></i><div id="transapp-export-text" class="required" style="font-weight:bold;"></div>',titleAttr:"Download CSV",action:l}],ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,processing:!0,stateSave:!0,scrollX:!0,paging:!0,ajax:{url:config.routes.transaction_datatable_route,data:function(e){e.transapp_start_date=$("#transapp_start_date").val(),e.transapp_stop_date=$("#transapp_stop_date").val(),e.transactor=$("#transactor_value").val(),e.handler=$("#handler_value").val(),e.insurance_company=$("#insurance_company_value").val(),e.reason=$("#reason_value").val(),e.payment_mode=$("#payment_mode_value").val(),e.transapp_approval_code=$("#transapp_approval_code").val(),e.transapp_customer_email=$("#customer_email").val(),e.transapp_customer_name=$("#customer_name").val(),e.team_id=$("#team").val()}},drawCallback:function(){let e=this.api().data();if(e[0]){let a=e[0].premium_total.toFixed(2);$("#total_premium_value").html(a)}else $("#total_premium_value").html("0")},columns:[{data:"approval_code",name:"approval_code"},{data:"created_at",name:"created_at"},{data:"insurance",name:"insurance"},{data:"amount_paid",name:"amount_paid"},{data:"customer_name",name:"customer_name"},{data:"risk_details",name:"risk_details"},{data:"created_by_name",name:"created_by_name"},{data:"handler_name",name:"handler_name"},{data:"payment_mode",name:"payment_mode"},{data:"prev_approval_code",name:"prev_approval_code"}]});$("#transapp-export").hide(),$("#search-transactions").submit((function(e){e.preventDefault();var t=$("#transapp_start_date"),d=$("#transapp_stop_date"),n=$("#message"),r=$("#transapp-export"),o=t.val(),i=d.val(),l=new Date(o),s=(new Date(i).getTime()-l.getTime())/864e5;return""==o||""==i?(n.html("Please select start & stop dates"),t.css("border-color","red"),d.css("border-color","red"),r.hide(),!1):o>i?(n.html("Start date must be equal or less than stop date"),t.css("border-color","red"),d.css("border-color","red"),r.hide(),!1):s>30?(n.html("Allowed number of days between start & stop dates are 30 days."),t.css("border-color","red"),d.css("border-color","red"),r.hide(),!1):(a.draw(),$(".loader").show(),n.html(""),t.css("border-color",""),d.css("border-color",""),r.show(),setTimeout((()=>{$(".loader").hide()}),1e3),void(1==$("#isTransappAdmin").val()?$("a[title='Download CSV']").show():$("a[title='Download CSV']").hide()))})),$("#transapp-export").click((function(){console.log("clicked on export-export"),$("#transapp-export").hide(),$("#transapp-export-text").text("Please wait until csv file will be downloaded. More waiting time is depending on number of records."),$("#transapp-export-text").show().delay(1e4).fadeOut()})),$("#search-users").submit((function(a){a.preventDefault(),$(".loader").show(),e.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$(".reason-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.reason_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.reason_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"is_active",name:"is_active"},{data:"created_by",name:"created_by"},{data:"updated_by",name:"updated_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".paymentmode-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.paymentmode_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.paymentmode_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"is_active",name:"is_active"},{data:"created_by",name:"created_by"},{data:"updated_by",name:"updated_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});var t=$(".claim-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.claim_datatable_route,data:function(e){e.searchtype=$("#search_type").val(),e.searchfield=$("input[name=searchfield]").val(),e.claimstatus=$("#claim_status_value").val(),e.assignedto=$("#assigned_to_value").val(),e.type_of_insurance=$("#type_of_insurance_value").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.claim_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"ticket_number",name:"ticket_number"},{data:"policy_number",name:"policy_number"},{data:"first_name",name:"first_name"},{data:"last_name",name:"last_name"},{data:"email_address",name:"email_address"},{data:"phone_number",name:"phone_number"},{data:"type_of_insurance_text",name:"type_of_insurance_text"},{data:"claims_status_text",name:"claims_status_text"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});function d(){var e=$("#type_of_insurances_id option:selected").attr("data-id");"Business"==e?$("#sub_type_of_insurance").show():$("#sub_type_of_insurance").hide(),"Car"==e?$("#car_fields").show():$("#car_fields").hide()}$("#search-claims").submit((function(e){e.preventDefault(),$(".loader").show(),t.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$(".typeofinsurance-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.typeofinsurance_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.typeofinsurance_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".vehicledepreciation-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.vehicledepreciation_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.vehicledepreciation_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"car_make_text",name:"car_make_text"},{data:"car_model_text",name:"car_model_text"},{data:"ip_text",name:"ip_text"},{data:"first_year",name:"first_year"},{data:"second_year",name:"first_year"},{data:"third_year",name:"first_year"},{data:"fourth_year",name:"first_year"},{data:"fifth_year",name:"first_year"},{data:"sixth_year",name:"first_year"},{data:"seventh_year",name:"first_year"},{data:"eighth_year",name:"first_year"},{data:"ninth_year",name:"first_year"},{data:"tenth_year",name:"first_year"}]}),$(".subtypeofinsurance-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.subtypeofinsurance_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.subtypeofinsurance_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".claimsstatus-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.claimsstatus_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.claimsstatus_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".carrepaircoverage-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.carrepaircoverage_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.carrepaircoverage_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".carrepairtype-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.carrepairtype_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.carrepairtype_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$("#car_make_id").on("change",(function(e){var a=$("#car_make_id option:selected").attr("data-id");a||(a=$("#car_make_id option:selected").val()),$.get("/car-model?make_code="+a,(function(e){var a=$("#car_model_id").empty();a.append('<option data-id="" value="">Please confirm Car Model</option>'),$.each(e,(function(e,t){$("<option/>",{id:e,value:t});a.append('<option data-id="'+t.code+'" value="'+t.id+'">'+t.text+"</option>")}))}))})),$("#sub_type_of_insurance").hide(),$("#car_fields").hide(),d(),$("#type_of_insurances_id").on("change",(function(e){d()})),$(".payment-link-copy").on("click",(function(){var e=$(this).attr("data-planId"),a=$(this).attr("data-quoteUUId"),t=$(this).attr("data-providerCode"),d=`${$(this).attr("data-websiteURL")}/car-insurance/quote/${a}/payment/?providerCode=${t}&planId=${e}`;navigator.clipboard.writeText(d);var n=this;$(this).text("Copied !"),setTimeout((function(){$(n).text("Copy")}),2e3)})),$("#btn_copy_doc_upload_link").on("click",(function(){var e=$(this).data("doc-upload-url");navigator.clipboard.writeText(e);var a=this;$(this).text("Copied !"),setTimeout((function(){$(a).text($(a).data("label"))}),2e3)}));var n=$(".customer-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.customer_data_table_route,data:function(e){e.searchtype=$("#search_type").val(),e.searchfield=$("#searchfield").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.customer_data_table_route+"/"+t.uuid+"'>"+t.id+"</a>"}},{data:"first_name",name:"first_name"},{data:"email",name:"email"},{data:"mobile_no",name:"mobile_no"},{data:"gender",name:"gender"},{data:"has_alfred_access",name:"has_alfred_access"},{data:"dob",name:"dob",orderable:!1,searchable:!1},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),r=$(".base-discount-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.discount_base_data_table_route,data:function(e){e.vehicle_type=$("#vehicle_type").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.discount_base_data_table_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"value_start",name:"value_start"},{data:"value_end",name:"value_end"},{data:"vehicle_type_text",name:"vehicle_type_text"},{data:"comprehensive_discount",name:"comprehensive_discount"},{data:"agency_discount",name:"agency_discount"},{data:"is_active",name:"is_active",orderable:!1,searchable:!1},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});$(".age-discount-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.age_discount_datatable_route},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.age_discount_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"age_start",name:"age_start"},{data:"age_end",name:"age_end"},{data:"discount",name:"discount"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});$("#search-customer").submit((function(e){e.preventDefault(),$(".loader").show(),n.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$("#search-vehicleTypes").submit((function(e){e.preventDefault(),$(".loader").show(),r.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$("#search-vehicleTypes-reset").click((function(e){e.preventDefault(),$(".loader").show(),$("#vehicle_type").val($("#vehicle_type option:first").val()),r.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)}));var o=$(".aml-data-table").DataTable({ordering:!1,info:!0,searching:!1,bLengthChange:!1,serverSide:!0,processing:!0,ajax:{url:config.routes.aml_datatable_route,error:function(e){if(422===e.status){var a=e.responseJSON;$.each(a.errors,(function(e,a){$("."+e+"-error").html(a).css("color","red")}))}},data:function(e){e.searchType=$("#searchType").val(),e.searchField=$("input[name=searchField]").val(),e.quoteType=$("#quoteTypeValue").val(),e.matchFound=$("#matchFound").val(),e.amlCreatedStartDate=$("#amlCreatedStartDate").val(),e.amlCreatedEndDate=$("#amlCreatedEndDate").val(),e.onLoadCheck=$("input[name='onLoadCheck']").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.aml_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"quote_type_text",name:"quote_type_text"},{data:"quote_request_id",name:"quote_request_id",render:function(e,a,t){return"<a href='"+config.routes.aml_datatable_route+"/"+t.quote_type_id+"/details/"+t.quote_request_id+"'>"+t.cdb_id+"</a>"}},{data:"input",name:"input"},{data:"screenshot",name:"screenshot",render:function(e,a,t,d){if(null!=e)return'<a href="'+e+'" target="_blank"><img class="img-responsive" src="'+e+'" alt="screenshot" height="80px" width="80px"></a>'}},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});$("#searchAML").submit((function(e){var a=$("#amlCreatedStartDate").val(),t=$("#amlCreatedEndDate").val(),d=$("#searchType").val(),n=$("#searchField").val();if($("input[name='onLoadCheck']").val(0),$(".quoteType-error, .searchField-error, .amlCreatedStartDate-error, .amlCreatedEndDate-error").html("").css("color",""),$("#amlCreatedStartDate, #amlCreatedEndDate").css({"border-color":""}),$("#amlCreatedStartDateMsg").html(""),""!=d&&""==n)return $(".searchField-error").html("Please select search value").css("color","red"),$("#searchField").css("border-color","red"),!1;if($(".searchField-error").html("").css("color",""),$("#searchField").css({"border-color":""}),""==d&&(""==a||""==t))return $("#amlCreatedStartDateMsg").html("Please select start & end dates"),$("#amlCreatedStartDate").css("border-color","red"),$("#amlCreatedEndDate").css("border-color","red"),!1;if(""!=a&&""!=t){var r=new Date(a);if((new Date(t).getTime()-r.getTime())/864e5>30)return $("#amlCreatedStartDateMsg").html("Allowed no. of days between start & end dates are 30 days."),$("#amlCreatedStartDate").css("border-color","red"),$("#amlCreatedEndDate").css("border-color","red"),$("#amlCreatedEndDateMsg").html(""),!1;if(a>t)return $("#amlCreatedStartDateMsg").html("Start date must be equal or less than end date"),$("#amlCreatedStartDate").css("border-color","red"),$("#amlCreatedEndDate").css("border-color","red"),$("#amlCreatedEndDateMsg").html(""),!1;$("#amlCreatedStartDateMsg").html(""),$("#amlCreatedEndDateMsg").html(""),$("#amlCreatedStartDate").css("border-color",""),$("#amlCreatedEndDate").css("border-color",""),e.preventDefault(),$(".loader").show(),o.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)}else $("#amlCreatedStartDateMsg").html(""),$("#amlCreatedEndDateMsg").html(""),$("#amlCreatedStartDate").css("border-color",""),$("#amlCreatedEndDate").css("border-color",""),e.preventDefault(),$(".loader").show(),o.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$(".tminsurancetype-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.tminsurancetype_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.tminsurancetype_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"code",name:"code"},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".tmcallstatus-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.tmcallstatus_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.tmcallstatus_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"code",name:"code"},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".tmleadstatus-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.tmleadstatus_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.tmleadstatus_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"code",name:"code"},{data:"text",name:"text"},{data:"text_ar",name:"text_ar"},{data:"sort_order",name:"sort_order"},{data:"is_active",name:"is_active"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});var i=$(".tmlead-data-table").DataTable({dom:"Bfrtip",buttons:[{extend:"csv",text:'<i class="fa fa-download" style="color:orange;" id="tm-leads-export"></i><div id="tm-leads-export-text" class="required" style="font-weight:bold;"></div>',titleAttr:"Download CSV",action:l}],ordering:!1,info:!0,searching:!1,bLengthChange:!1,serverSide:!0,stateSave:!0,paging:!0,processing:!0,scrollX:!0,ajax:{url:config.routes.tmlead_datatable_route,data:function(e){e.searchType=$("#searchType").val(),e.searchField=$("input[name=searchField]").val(),e.assigned_to_id=$("#assigned_to_id").val(),e.tm_insurance_types_id=$("#tm_insurance_types_id").val(),e.tm_lead_types_id=$("#tm_lead_types_id").val(),e.tm_lead_statuses_id=$("#tm_lead_statuses_id").val(),e.tmLeadsStartDate=$("#tmLeadsStartDate").val(),e.tmLeadsEndDate=$("#tmLeadsEndDate").val()}},columns:[{data:"id",name:"id",render:function(e,a,t,d){if(0==$("#isCurrentUserIsAdvisor").val())return'<input type="checkbox" id="tmLeadID" class="tmleadCheckbox" name="tmLeadID" value="'+e+'">'}},{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.tmlead_datatable_route+"/"+t.id+"'>"+t.cdb_id+"</a>"}},{data:"customer_name",name:"customer_name"},{data:"tm_insurance_types_text",name:"tm_insurance_types_text"},{data:"tm_lead_type",name:"tm_lead_type"},{data:"tm_lead_status_text",name:"tm_lead_status_text"},{data:"notes",name:"notes"},{data:"enquiry_date",name:"enquiry_date"},{data:"allocation_date",name:"allocation_date"},{data:"next_followup_date",name:"next_followup_date"},{data:"handlers_name",name:"handlers_name"},{data:"tm_created_at",name:"created_at"},{data:"tm_updated_at",name:"updated_at"}],createdRow:function(e,a,t){if("NoAnswer"==a.tm_lead_status_code||"SwitchedOff"==a.tm_lead_status_code||"PipelineNoInfo"==a.tm_lead_status_code||"PipelineImmediate"==a.tm_lead_status_code||"PipelineFuture"==a.tm_lead_status_code||"DealingWithAnAdvisor"==a.tm_lead_status_code){var d=new Date;d.getFullYear()+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+("0"+d.getDate()).slice(-2)+" "+("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2)+":"+("0"+d.getSeconds()).slice(-2)>a.next_followup_date&&$("td",e).eq(8).css("color","red")}}});function l(e,a,t,d){var n=this,r=a.settings()[0]._iDisplayStart;a.one("preXhr",(function(e,o,i){i.start=0,i.length=2147483647,a.one("preDraw",(function(e,o){return t[0].className.indexOf("buttons-csv")>=0&&($.fn.dataTable.ext.buttons.csvHtml5.available(a,d)?$.fn.dataTable.ext.buttons.csvHtml5.action.call(n,e,a,t,d):$.fn.dataTable.ext.buttons.csvFlash.action.call(n,e,a,t,d)),a.one("preXhr",(function(e,a,t){o._iDisplayStart=r,t.start=r})),setTimeout(a.ajax.reload,0),!1}))})),a.ajax.reload()}function s(){var e=$("#tm_insurance_types_id option:selected").attr("data-id");"Car"==e?$("#tm_car_fields").show():$("#tm_car_fields").hide(),"Car"==e||"Bike"==e||"Life"==e||"Health"==e||"Critical"==e?$("#tm_dob_field").show():$("#tm_dob_field").hide()}function c(){var e=$("#tm_lead_statuses_id option:selected").attr("data-id");"NoAnswer"==e||"SwitchedOff"==e||"PipelineNoInfo"==e||"PipelineImmediate"==e||"PipelineFuture"==e||"DealingWithAnAdvisor"==e||"NewLead"==e&&""!=tmLeadEditFormNextFollowupDate?$("#next_followup_date_field").show():$("#next_followup_date_field").hide()}i.column(4).visible(!1),$("#tm-leads-export").click((function(){$("#tm-leads-export").hide(),$("#tm-leads-export-text").text("Please wait until csv file will be downloaded. More waiting time is depending on number of records."),$("#tm-leads-export-text").show().delay(1e4).fadeOut()})),$("#tm-leads-upload-csv-button").click((function(){$("#tm-leads-upload-csv-button").hide(),$("#tm-leads-upload-csv-button-text").text("Please wait until csv file will be uploaded. More waiting time is depending on number of records.")})),$("#tm-leads-export").hide(),$("#search-tm-leads").submit((function(e){e.preventDefault();var a=$("#tmLeadsStartDate").val(),t=$("#tmLeadsEndDate").val(),d=$("#searchType").val();if("created_at"==d||"updated_at"==d||"next_followup_date"==d||"enquiry_date"==d||"allocation_date"==d){var n=new Date(a),r=(new Date(t).getTime()-n.getTime())/864e5;if(""==a||""==t)return $("#result").html("Please select start & end dates"),$("#tmLeadsStartDate").css("border-color","red"),$("#tmLeadsEndDate").css("border-color","red"),$("#tm-leads-export").hide(),!1;if(a>t)return $("#result").html("Start date must be equal or less than end date"),$("#tmLeadsStartDate").css("border-color","red"),$("#tmLeadsEndDate").css("border-color","red"),$("#tm-leads-export").hide(),!1;if(r>30)return $("#result").html("Allowed number of days between start and and dates are 30 days."),$("#tmLeadsStartDate").css("border-color","red"),$("#tmLeadsEndDate").css("border-color","red"),$("#tm-leads-export").hide(),!1;i.draw(),$(".loader").show(),$("#result").html(""),$("#tmLeadsStartDate").css("border-color",""),$("#tmLeadsEndDate").css("border-color",""),$("#tm-leads-export").show(),setTimeout((()=>{$(".loader").hide()}),1e3),0==$("#isCurrentUserIsAdvisor").val()?$("a[title='Download CSV']").show():$("a[title='Download CSV']").hide()}else i.draw(),$(".loader").show(),$("#result").html(""),$("#tmLeadsStartDate").css("border-color",""),$("#tmLeadsEndDate").css("border-color",""),$("#tm-leads-export").hide(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$("#healthPlansAll").on("click",(function(){$(this).is(":checked")?$(".health-plans-checkbox").prop("checked",this.checked):$(".health-plans-checkbox").removeAttr("checked")})),$("#checkAllTmLeads").click((function(){$("input:checkbox").not(this).prop("checked",this.checked),$("#selectTmLeadId").val("");var e=$("#selectTmLeadId").val();$("input:checkbox").each((function(a,t){e=e+$(t).val()+","})),$("#selectTmLeadId").val(e.replace(/^,|,$/g,"")),$(this).is(":checked")?$("#tm-leads-assign-div").show(300):$("#tm-leads-assign-div").hide(200)})),$("#assign_team").on("change",(function(){"GM"==$(this).val()?$("#assigned_to_id_new").attr("disabled",!0):$("#assigned_to_id_new").attr("disabled",!1)})),$("#tmLeadsAssignToUser").click((function(){var e=[];if($("#healthTeamTypeAssignDiv").length>0&&""==$("#assign_team").val())return $("#teamErrorSpan").show().fadeOut(5e3),!1;$("#checkAllTmLeads").is(":checked")||($.each($("input[name='tmLeadID']:checked"),(function(){e.push($(this).val())})),$("#selectTmLeadId").val(e))})),$("#assignAfterTeam").click((function(){var e=[];if(""==$("#assign_team").val())return $("#teamAssignValidation").show().fadeOut(5e3),!1;$("#checkAllTmLeads").is(":checked")||($.each($("input[name='tmLeadID']:checked"),(function(){e.push($(this).val())})),$("#selectTmLeadId").val(e))})),$(document).on("change","#tmLeadID",(function(){var e=$("#selectTmLeadId").val();e=e+","+$(this).val()+",",$("#selectTmLeadId").val(e.replace(/^,|,$/g,"")),document.querySelectorAll("#tmLeadID:checked").length>0?$("#tm-leads-assign-div").show(300):($("#checkAllTmLeads").prop("checked",!1),$("#tm-leads-assign-div").hide(300))})),$("#tm-leads-assign-div").hide(),$("#ignore-redirection").click((function(){return!1})),$("#tm_car_fields").hide(),$("#tm_dob_field").hide(),s(),$("#tm_insurance_types_id").on("change",(function(e){s()})),$("#next_followup_date_field").hide(),c(),$("#tm_lead_statuses_id").on("change",(function(e){c()})),$("#tmLeads-search-value-filter").show(),$("#tmLeads-search-start-end-dates-filters").hide(),$("#searchType").on("change",(function(e){var a;a=$("#searchType").val(),console.log("searchTypeValue: "+a),"created_at"==a||"updated_at"==a||"next_followup_date"==a||"enquiry_date"==a||"allocation_date"==a?($("#tmLeads-search-start-end-dates-filters").show(300),$("#tmLeads-search-value-filter").hide(300)):($("#tmLeads-search-start-end-dates-filters").hide(300),$("#tmLeads-search-value-filter").show(300),$("#tmLeadsStartDate").val(""),$("#tmLeadsEndDate").val(""))})),$("#search-tm-leads #searchType").on("change",(function(e){$("#searchField").val("")})),$(".tmuploadlead-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,stateSave:!0,paging:!0,processing:!0,ajax:config.routes.tmuploadlead_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.tmuploadlead_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"file_name",name:"file_name"},{data:"good",name:"good"},{data:"user_name",name:"user_name"},{data:"created_at",name:"created_at"}]}),$("#select_all_checkboxes").click((function(e){!0===e.target.checked?$(".multicheckbox").each((function(e){$(this).prop("checked",!0)})):$(".multicheckbox").each((function(e){$(this).prop("checked",!1)}))})),$(".quotePlanModalPopup").on("click",(function(e){e.preventDefault(),$(".quote-plan-modal-body").load($(this).attr("planDetailUrl"),(function(){$("#quotePlanModal").modal({show:!0})}))})),$("#duplicateLeadModalBtn").on("click",(function(e){e.preventDefault(),$("#duplicateLeadModal").modal({show:!0})})),$("#add-activity-btn").on("click",(function(){$("#activityModal").modal({show:!0})})),$("#add-edit-travel-members-btn").on("click",(function(){$("#addTravelMemberModal").modal({show:!0})})),$("#due_date").daterangepicker({timePicker:!0,singleDatePicker:!0,timePicker24Hour:!0,locale:{format:"DD-MM-YYYY HH:mm:ss"}}),$("#quotePlansGenerateButton").click((function(){var e=$("#quotePlansGenerateUrl").val();navigator.clipboard.writeText(e),$("#quotePlansGenerateMsg").show(300),$("#quotePlansGenerateMsg").hide(2e3)})),$(".auditablebtn").click((function(){var e=$(this).attr("data-id"),a=$(this).attr("data-model");$(this).attr("disabled",!0),$.ajax({url:config.routes.load_auditable,method:"POST",data:{auditableId:e,auditableType:a,_token:config._token},success:function(e){$("#auditable").html(e),$(".auditablebtn").hide()}})})),$(".apilogsbtn").click((function(){var e=$(this).attr("data-id"),a=$(this).attr("data-model");$(this).attr("disabled",!0),$.ajax({url:config.routes.load_apilogs,method:"POST",data:{auditableId:e,auditableType:a,_token:config._token},success:function(e){$("#apilogsdiv").html(e),$(".apilogsbtn").hide()}})})),$("#return_to_view").click((function(e){e.preventDefault();$("#redirect_to_view_div").html('<input name="return_to_view" type="hidden" value="1"/>'),setTimeout((function(){$("#demo-form2").submit()}),500)})),$(".manager-renewals-leads-data-table").DataTable({ordering:!1,info:!0,searching:!1,bLengthChange:!1,processing:!0,stateSave:!0,paging:!0,ajax:config.routes.renewals_leads_datatable_route,columns:[{data:"id",name:"id"},{data:"renewal_import_type",name:"renewal_import_type"},{data:"renewal_import_code",name:"renewal_import_code"},{data:"file_name",name:"file_name"},{data:"total_records",name:"total_records"},{data:"good",name:"good",render:function(e,a,t){return"<a href='"+config.routes.renewal_uploaded_leads+"/"+t.id+"/validation-passed'>"+t.good+"</a>"}},{data:"cannot_upload",name:"cannot_upload",render:function(e,a,t){return"<a href='"+config.routes.renewal_uploaded_leads+"/"+t.id+"/validation-failed'>"+t.cannot_upload+"</a>"}},{data:"status",name:"status"},{data:"uploaded_by",name:"uploaded_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".renewals-leads-data-table").DataTable({ordering:!1,info:!0,searching:!1,bLengthChange:!1,processing:!0,stateSave:!0,paging:!0,ajax:config.routes.renewals_leads_datatable_route,columns:[{data:"id",name:"id"},{data:"renewal_import_type",name:"renewal_import_type"},{data:"renewal_import_code",name:"renewal_import_code"},{data:"file_name",name:"file_name"},{data:"total_records",name:"total_records"},{data:"good",name:"good",render:function(e,a,t){return"<a href='"+config.routes.renewal_uploaded_leads+"/"+t.id+"/validation-passed'>"+t.good+"</a>"}},{data:"cannot_upload",name:"cannot_upload",render:function(e,a,t){return"<a href='"+config.routes.renewal_uploaded_leads+"/"+t.id+"/validation-failed'>"+t.cannot_upload+"</a>"}},{data:"status",name:"status"},{data:"uploaded_by",name:"uploaded_by"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),$(".validation-failed-data-table").DataTable({ordering:!1,info:!0,searching:!1,bLengthChange:!1,processing:!0,stateSave:!0,paging:!0,ajax:config.routes.renewal_uploaded_leads,columns:[{data:"batch",name:"batch"}]}),$("#car_make_value").on("change",(function(e){var a=$("#car_make_value option:selected").attr("data-id");$.get("/valuation/car-models?make_code="+a,(function(e){var a=$("#car_model_value").empty();a.append('<option value="">Select</option>'),$.each(e,(function(e,t){$("<option/>",{id:e,value:t});a.append('<option value="'+t.id+'">'+t.text+"</option>")}))}))})),$("#car_model_value").on("change",(function(e){var a=$("#car_model_value option:selected").val();$.get("/valuation/car-model-detail?modelId="+a,(function(e){var a=$("#car_trim_value").empty();a.append('<option value="">Select</option>'),0==e.length&&(a.append('<option value="">No Trim Available</option>'),$("#car_trim_value option:eq(1)").prop("selected",!0)),$.each(e,(function(e,t){$("<option/>",{id:e,value:t});a.append('<option value="'+t.id+'">'+t.text+"</option>")}))}))})),$(document).on("click",".delete",(function(){var e=$(this).attr("date-route");$("#delete-form").attr("action",e),$("#exampleModal").modal("show")}));$(".corpline-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.amtDataTable,data:function(e){e.leadType=$("#leadStatus").val(),e.cdbID=$("#cdbID").val()}},columns:[{data:"code",name:"code",render:function(e,a,t){return"<a href='"+("/quotes/business/"+t.uuid)+"'>"+t.code+"</a>"}},{data:"first_name",name:"first_name"},{data:"last_name",name:"last_name"},{data:"leadStatus",name:"leadStatus"},{data:"leadType",name:"leadType"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});$("#manualAssignBtn").on("click",(function(e){e.preventDefault(),""==$("#assigned_to_id_new").val()?$("#userAssignValidation").show().fadeOut(5e3):$.ajax({url:"/leadassignment/manualLeadAssign",type:"PUT",data:{selectTmLeadId:$("#entityId").val(),assigned_to_id_new:$("#assigned_to_id_new").val(),_token:config._token},success:function(e){$("#teamassignmentSuccess").html("Team Assigned Successfully").show().fadeOut(5e3),setTimeout((()=>{window.location.reload(!0)}),2e3)},error:function(e,a,t){console.log(e,a,t)}})})),$("#group_medical_type_id").on("change",(function(){var e=$(this).find("option:selected").data("id");e?(e=e.replace(/(\r\n|\n|\r)/gm,""),$("#tooltipGm").show(),$("#tooltipGm").attr("title",e)):$("#tooltipGm").hide()})),$("#lob_team").select2({placeholder:"Select LOB For Duplication",allowClear:!0,width:"100%"}),$(".vehiclevalue-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:config.routes.vehiclevalue_datatable_route,columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.vehiclevalue_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"car_make_text",name:"car_make_text"},{data:"car_model_text",name:"car_model_text"},{data:"car_trim_text",name:"car_trim_text"},{data:"ip_text",name:"ip_text"},{data:"current_value",name:"current_value"}]}),$("#loadHistoryDataBtn").on("click",(function(e){e.preventDefault();var a=$("input[name=modelType]").val().toLowerCase(),t=$("input[name=leadId]").val();$.ajax({url:"/quotes/getLeadHistory?modelType="+a+"&recordId="+t,type:"GET",success:function(e){var a="";if(e.length>0)for(let t=0;t<e.length;t++){const d=e[t];d.ModifiedAt=null==d.ModifiedAt?"":d.ModifiedAt,d.ModifiedBy=null==d.ModifiedBy?"":d.ModifiedBy,d.NewStatus=null==d.NewStatus?"":d.NewStatus,d.NewAdvisor=null==d.NewAdvisor?"":d.NewAdvisor,d.NewNotes=null==d.NewNotes?"":d.NewNotes,a=a+"<tr><td>"+d.ModifiedAt+"</td><td>"+d.ModifiedBy+"</td><td>"+d.NewNotes+"</td><td>"+d.NewStatus+"</td></tr>"}else a='<tr><td colspan="5" style="text-align: center">No data available</td></tr>';$("#leadhistorydatatable tbody").html(a)},error:function(e,a,t){console.log(e,a,t)}})})),$("#loadQuoteStatusLog").on("click",(function(e){e.preventDefault();var a=$("input[name=modelType]").val().toLowerCase(),t=$("input[name=leadId]").val();let d=$(this).attr("data-quote-type-id");$.ajax({url:"/quotes/lead-history?modelType="+a+"&recordId="+t+"&quoteTypeId="+d,type:"GET",success:function(e){var a="";if(e.length>0)for(let t=0;t<e.length;t++){const d=e[t];a=a+"<tr><td>"+(null==d?.created_at?"":d.created_at)+"</td><td>"+(d?.created_by?.email?d.created_by.email:"")+"</td><td>"+(d?.previous_quote_status?.text?d.previous_quote_status.text:"")+"</td><td>"+(d?.current_quote_status?.text?d.current_quote_status.text:"")+"</td><td>"+(d?.notes?d.notes:"")+"</td></tr>"}else a='<tr><td colspan="5" style="text-align: center">No data available</td></tr>';$("#quoteStatusLogsTable tbody").html(a)},error:function(e,a,t){console.log(e,a,t)}})})),disabledDoneActivities(),$(".activityChk1").on("change",(function(e){$.ajax({url:"/activities/updateStatus",method:"POST",data:{activity_id:$(this).val(),_token:$("input[name=_token]").val()},success:function(e){disabledDoneActivities()}})})),$(".renewals-batches-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,stateSave:!0,paging:!0,processing:!0,ajax:config.routes.renewals_batches_datatable_route,columns:[{data:"renewal_batch",name:"renewal_batch"},{data:"renewal_batch",name:"manage_plans",render:function(e,a,t){return"<a class='btn btn-info btn-sm' href='"+config.routes.renewals_batches_datatable_route+"/"+t.renewal_batch+"/plans-processes'>Fetch Plans</a><a class='btn btn-warning btn-sm' href='"+config.routes.renewals_batches_datatable_route+"/"+t.renewal_batch+"'>Send Emails</a>"}}]}),$(".generateCCLink").click((function(){$(".loader").show(),$.ajax({url:"/generate-payment-link",method:"POST",data:{_token:$("input[name=_token]").val(),modelType:$(this).attr("data-modelType"),quoteId:$(this).attr("data-quoteId"),paymentCode:$(this).attr("data-paymentCode")},success:function(e){e.success?(navigator.clipboard.writeText(e.payment_link),$(".loader").hide(),$("#generateCCLinkMsg").show().delay(1e3).fadeOut()):($(".loader").hide(),alert(e))}})})),$(".btn-change-insurer").on("click",(function(){if(!confirm("Are you sure to change insurer"))return!1;{let e=$(this);$(e).btnLoader(),$.ajax({url:"/quotes/car/change-insurer",method:"POST",data:{uuid:$(this).attr("data-uuid"),plan_id:$(this).attr("data-planId"),provider_code:$(this).attr("data-providerCode"),_token:$("input[name=_token]").val()},success:function(a){$(e).btnResetLoader(),setTimeout((function(){alert(a.message),window.location.reload()}),0)},error:function(a){$(e).btnResetLoader();let t="";$.each(a.responseJSON.errors,(function(e,a){t+=a+"\n"})),alert(t)}})}})),$.fn.btnLoader=function(){let e="<i class='fa fa-spinner fa-spin'></i> "+this.html();return this.data("original-text",this.html()),this.html(e).attr("disabled","disabled"),this},$.fn.btnResetLoader=function(){let e=this.data("original-text");return this.html(e).removeAttr("disabled"),this},$(".payment-link-copy").on("click",(function(){var e=$(this).attr("data-planId"),a=$(this).attr("data-quoteUUId"),t=$(this).attr("data-providerCode"),d=`${$(this).attr("data-websiteURL")}/car-insurance/quote/${a}/payment/?providerCode=${t}&planId=${e}`;navigator.clipboard.writeText(d);var n=this;$(this).text("Copied !"),setTimeout((function(){$(n).text("Copy")}),2e3)})),$(".enable-bnpl").on("click",(function(){var e=$(this).attr("data-planId"),a=$(this).attr("data-quoteUUId");$.ajax({url:"/update-car-plan-details",method:"POST",data:{plan_id:e,quote_uuid:a,_token:config._token},success:function(e){window.location.reload()}})})),$("#btn_download_plan_pdf").on("click",(function(){if($("input[name='toggle_plans_checkbox']:checked").length<3)return alert("Please select at least three (3) plans to download pdf."),!1;if($("input[name='toggle_plans_checkbox']:checked").length>5)return alert("A maximum of five (5) plans are allowed to be selected."),!1;var e=[];$.each($("input[name='toggle_plans_checkbox']:checked"),(function(){e.push($(this).val())})),$("#plan_ids").val(e),$("#form_plans_pdf").submit()})),$('select[name="segment_volume[]"]').change((function(){var e=$(this).val();$('select[name="segment_value[]"] option').prop("disabled",!1),$('select[name="segment_value[]"] option').filter((function(){return e.includes($(this).val())})).prop("disabled",!0).addClass("unavailable-option")})),$('select[name="segment_value[]"]').change((function(){var e=$(this).val();$('select[name="segment_volume[]"] option').prop("disabled",!1),$('select[name="segment_volume[]"] option').filter((function(){return e.includes($(this).val())})).prop("disabled",!0).addClass("unavailable-option")}))})),$("#btn_download_plan_pdf_health").on("click",(function(){if($("input[name='health_plans_checkbox']:checked").length<3)return alert("Please select at least three (3) plans."),!1;if($("input[name='health_plans_checkbox']:checked").length>5)return alert("A maximum of five (5) plans are allowed to be selected."),!1;var e=[];$.each($("input[name='health_plans_checkbox']:checked"),(function(){e.push($(this).val())})),$("#plan_ids").val(e),$("#form_plans_pdf").submit()})),$("#renewals-upload-button").click((function(){$("#renewals-upload-button").hide(),$("#renewals-upload-button-text").text("Please wait until file will be uploaded. More waiting time is depending on number of records.")})),$("#send-note-for-customer-btn").on("click",(function(){$("#notesForCustomerModal").modal({show:!0})})),$("#quote_policy_issuance_date, #quote_policy_start_date, #quote_policy_expiry_date").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd-mm-yy"}),$("#dataTableCarQuotePlans").DataTable({paging:!1,ordering:!1,info:!1,searching:!1,bLengthChange:!1,scrollX:!0}),$("#toggle-plans-div").hide(),$("#flowcheckall").click((function(e){$(this).hasClass("checkedAll")?($("#toggle-plans-div").hide(200),$(".car_plans_checkbox").prop("checked",!1),$(this).removeClass("checkedAll")):($(".car_plans_checkbox").prop("checked",!0),$(this).addClass("checkedAll"),$("#toggle-plans-div").show(300))})),$(".car_plans_checkbox").click((function(e){$(this).is(":checked")?$("#toggle-plans-div").show(300):$("#toggle-plans-div").hide(200)})),$("#togglePlans").on("click",(function(){if(""!=$("#toggle").val()){var e=[];$.each($("input[name='toggle_plans_checkbox']:checked"),(function(){e.push($(this).val())})),$("#planIds").val(e),$("#togglePlanForm").submit()}})),$("#dob").prop("type","text"),$("#dob_div #dob").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd-mm-yy",yearRange:"-80:+00"}),$("#policy_start_date").prop("type","text"),$("#policy_start_date").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"dd/mm/yy",yearRange:"-80:+00",minDate:new Date}),$("#send-one-click-buy-email-btn").on("click",(function(){if(!confirm("Are you sure send email to customer?"))return!1;var e=$(this).attr("data-quote-type"),a=$(this).attr("data-quote-uuid");$(".loader").show(),$.ajax({url:"/quotes/"+e+"/"+a+"/send-email-one-click-buy",method:"POST",data:{quote_type_id:$(this).attr("data-quote-type-id"),quote_id:$(this).attr("data-quote-id"),quote_uuid:a,quote_cdb_id:$(this).attr("data-quote-cdb-id"),quote_previous_expiry_date:$(this).attr("data-quote-previous-expiry-date"),quote_currently_insured_with:$(this).attr("data-quote-currently-insured-with"),quote_car_make:$(this).attr("data-quote-car-make"),quote_car_model:$(this).attr("data-quote-car-model"),quote_car_year_of_manufacture:$(this).attr("data-quote-car-year-of-manufacture"),quote_previous_policy_number:$(this).attr("data-quote-previous-policy-number"),customer_name:$(this).attr("data-quote-customer-name"),customer_email:$(this).attr("data-quote-customer-email"),advisor_name:$(this).attr("data-quote-advisor-name"),advisor_email:$(this).attr("data-quote-advisor-email"),advisor_mobile_no:$(this).attr("data-quote-advisor-mobile-no"),advisor_landline_no:$(this).attr("data-quote-advisor-landline-no"),_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),alert(e.success)},error:function(e){$(".loader").hide(),alert(e.responseJSON.error)}})}));var teamsDataTable=$(".teams-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.teams_datatable_route,data:function(e){e.name=$("#name").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.teams_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"name",name:"name"},{data:"type",name:"type"},{data:"parent.name",name:"parent.name"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"},{data:"is_active",name:"is_active"}]}),renewalBatchesDataTable=$(".renewal-batches-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,columns:[{data:"id",name:"id"},{data:"name",name:"name"},{data:"start_date",name:"start_date"},{data:"end_date",name:"end_date"},{data:"action",name:"action",orderable:!1,searchable:!1,render:function(e,a,t){return"<a class='btn btn-info' href='"+config.routes.renewal_batched_datatable_route+"/"+t.id+"/edit'>Edit</a>"}}]}),commercialKeywordsDataTable=$(".commercial-keywords-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.commercial_keywords_datatable_route,data:function(e){e.name=$("#name").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.commercial_keywords_datatable_route+"/view/"+t.id+"'>"+t.id+"</a>"}},{data:"key",name:"key"},{data:"name",name:"name"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]}),commercialVehiclesDataTable=$(".commercial-vehicles-data-table").DataTable({ordering:!1,info:!1,searching:!1,bLengthChange:!1,serverSide:!0,ajax:{url:config.routes.commercial_vehicles_datatable_route,data:function(e){e.text=$("#text").val()}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.commercial_vehicles_datatable_route+"/view/"+t.id+"'>"+t.id+"</a>"}},{data:"text",name:"text"},{data:"code",name:"code"},{data:"car_models",name:"car_models",title:"Commercial Car Models"}]});function additionalContactPrimaryConfirmed(e){$(".loader").show();var a=e.attr("data-record-id"),t=e.attr("data-quote-id"),d=e.attr("data-key"),n=e.attr("data-value"),r=e.attr("data-quote-type"),o=e.attr("data-quote-primary-email-address"),i=e.attr("data-quote-customer-id");$.ajax({url:"/customer-additional-contact/"+a+"/make-primary",method:"POST",data:{quote_id:t,key:d,value:n,quote_type:r,quote_primary_email_address:o,quote_customer_id:i,_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),e.data.message?alert(e.data.message):alert("Primary Email Updated"),location.reload()}})}function is_valid_email(e){return/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}function validation_div_text(e,a,t){$(e).text(a).attr("style","color:"+t)}function triggerTest(){console.log("Triggered")}$("#search-teams").submit((function(e){e.preventDefault(),$(".loader").show(),teamsDataTable.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$("#search-keywords").submit((function(e){e.preventDefault(),$(".loader").show(),commercialKeywordsDataTable.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$("#search-car-make").submit((function(e){e.preventDefault(),$(".loader").show(),commercialVehiclesDataTable.draw(),setTimeout((()=>{$(".loader").hide()}),1e3)})),$("#rule_type").change((function(){1==$(this).val()?$("#lead_source_id_div").show():($("#lead_source_id_div").hide(),$("#lead_source_id").val(""))})),$("#rule_car_make_id").on("change",(function(e){console.log("changed");var a=$("#rule_car_make_id option:selected").attr("data-id");a?$.get("/commercial-car-model-by-id?make_code="+a,(function(e){var a=$("#rule_car_model_id").empty();a.append('<option data-id="" value="">Please select rule car model</option>'),e.length>0?$.each(e,(function(e,t){$("<option/>",{id:e,value:t});a.append('<option data-id="'+t.code+'" value="'+t.id+'" selected>'+t.text+"</option>")})):a.append("<option disabled>No commercial vehicle record found for this car make</option>")})):console.log("Car make code not found")})),$("#additional-contact-add-btn").on("click",(function(){$("#customer-additional-contact-add-modal").modal({show:!0})})),$(".additional-email-make-primary-btn").on("click",(function(){var e=$(this);if(!confirm("Are you sure to make this primary email address?"))return!1;$(".loader").show(),$.ajax({url:"/customer-primary-email-check",method:"POST",data:{key:$(this).attr("data-key"),value:$(this).attr("data-value"),_token:$("input[name=_token]").val()},success:function(a){!0===a.response?confirm('You are about to set this "email" as the primary contact for this lead. This action will add this lead to the list of other existing leads associated with the same email. \n Are you sure you want to continue?')?additionalContactPrimaryConfirmed(e):$(".loader").hide():additionalContactPrimaryConfirmed(e)}})})),$(".additional-contact-delete-btn").on("click",(function(){if(!confirm("Are you sure to delete?"))return!1;$(".loader").show();var e=$(this).attr("data-customer-additional-contact-id");$.ajax({url:"/customer-additional-contact/"+e+"/delete",method:"POST",data:{_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),alert(e.data.message),location.reload()}})})),$("#additional-contact-modal-add-btn").on("click",(function(){var e=new RegExp("[a-zA-Z]"),a=$("#additional_contact_type").val(),t=$("#additional_contact").val(),d=$(this).attr("data-quote-id"),n=$(this).attr("data-quote-type"),r=$(this).attr("data-customer-id"),o=$(this).attr("data-contact-type-email-enum"),i=$(this).attr("data-contact-type-mobile-no-enum");return a==o&&!1===is_valid_email(t)?(validation_div_text("#additional-contact-modal-validation-msg","Please enter a valid email address.","red"),!1):a!=i||""!=t&&!e.test(t)?($(".loader").show(),validation_div_text("#additional-contact-modal-validation-msg","",""),void $.ajax({url:"/customer-additional-contact/add",method:"POST",data:{quote_id:d,customer_id:r,key:a,value:t,quote_type:n,_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),e.error&&e.error.message?validation_div_text("#additional-contact-modal-validation-msg",e.error.message,"red"):e.data.message?(alert("Contact Added."),location.reload()):validation_div_text("#additional-contact-modal-validation-msg","There was an error!","red")},error:function(e){$(".loader").hide();var a=e.responseJSON.errors;$.each(a,(function(e,a){validation_div_text("#additional-contact-modal-validation-msg",a,"red")}))}})):(validation_div_text("#additional-contact-modal-validation-msg","Please enter a valid  mobile number.","red"),!1)})),$(".additional-mobile-no-make-primary-btn").on("click",(function(){if(!confirm("Are you sure to make this primary mobile no.?"))return!1;$(".loader").show(),$.ajax({url:"/customer-additional-contact/0/make-primary",method:"POST",data:{quote_id:$(this).attr("data-quote-id"),key:$(this).attr("data-key"),value:$(this).attr("data-value"),quote_type:$(this).attr("data-quote-type"),quote_primary_mobile_no:$(this).attr("data-quote-primary-mobile-no"),quote_customer_id:$(this).attr("data-quote-customer-id"),_token:$("input[name=_token]").val()},success:function(e){$(".loader").hide(),e.data.message?alert(e.data.message):alert("Primary Mobile Updated"),location.reload()}})}));var amlDetailKycLogsDatatable=$(".aml-detail-data-table").DataTable({ordering:!1,info:!0,searching:!1,bLengthChange:!1,serverSide:!0,processing:!0,ajax:{url:config.routes.aml_kyc_logs_datatable_route,data:{quote_type_id:$(location).attr("href").split("/").splice(5)[0],quote_request_id:$(location).attr("href").split("/").splice(5)[2]}},columns:[{data:"id",name:"id",render:function(e,a,t){return"<a href='"+config.routes.aml_datatable_route+"/"+t.id+"'>"+t.id+"</a>"}},{data:"input",name:"input"},{data:"search_type",name:"search_type"},{data:"screenshot",name:"screenshot",render:function(e){if(null!=e)return'<a href="'+e+'" target="_blank"><img class="img-responsive" src="'+e+'" alt="screenshot" height="80px" width="80px"></a>'}},{data:"match_found",name:"match_found",render:function(e,a,t){return t.match_found>0?"True":"False"}},{data:"results_found",name:"results_found"},{data:"created_at",name:"created_at"},{data:"updated_at",name:"updated_at"}]});$(window).on("load",(function(){$("table").hasClass("aml-detail-data-table")&&($(".loader").show(),amlDetailKycLogsDatatable.draw(),setTimeout((()=>{$(".loader").hide()}),1e3))})),$(document).ready((function(){var e=$("#add_additional_btn"),a=$("#additional_info"),t=0;$(e).click((function(){t<10&&(t++,$(a).append('\n        <div class="item form-group">\n            <div class="col">\n                <span class="col-form-label col-md-6 col-sm-6"><b> Email Address (Optional)</b> </span>\n                <input type="email" name="emails[]" class="form-control" data-toggle="tooltip" data-placement="top" title="Please enter email address">\n            </div>\n            <div class="col">\n                <span class="col-form-label col-md-6 col-sm-6"><b>Phone number (Optional)</b> </span>\n                <input type="text" name="phones[]"class="form-control" data-toggle="tooltip" data-placement="top" title="Please enter 11 digit phone number. Example: 0563264418">\n            </div>\n            <a href="javascript:void(0);" class="remove_additional_btn" title="Add field"><img src="/image/remove-icon.png"/></a>\n            \n        </div> '))})),$(a).on("click",".remove_additional_btn",(function(e){e.preventDefault(),$(this).parent("div").remove(),t--}))}));
